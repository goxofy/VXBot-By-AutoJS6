import { Bot } from './src/bot.js'
import OpenAIBot from './src/plugins/openai_bot.js'
import ImageBot from './src/plugins/image_bot.js'
import VideoBot from './src/plugins/video_bot.js'

/**
 * 演示脚本
 * 使用 Bot 框架进行自动回复 (接入 OpenAI)
 */
const bot = new Bot();

// ================= 配置区域 =================

// 1. 白名单配置 (统一管理)
// 只有在这个列表里的会话，机器人的一级轮询才会点击进入，二级插件才会进行回复。
// 建议填入精准的好友昵称或群名。
const WHITELIST = []; // 例如 ["文件传输助手", "技术交流群"]

// 2. 插件配置

// [Image] 优先注册发图插件
bot.register(new ImageBot());

// [Video] 视频下载插件
bot.register(new VideoBot({
    serverUrl: "http://127.0.0.1:8080", // 自建服务端口地址，参考 https://github.com/wujunwei928/parse-video
    command: "下载" // 触发指令
}));

// [OpenAI] AI 对话插件 / 兜底插件
bot.register(new OpenAIBot({
    apiKey: "", // 请替换为你自己的 API Key
    baseUrl: "", // 支持自定义 Base URL
    model: "", // 支持自定义模型
    contextTimeout: 20 * 60 * 1000, // 上下文记忆超时时间 (毫秒)，默认 20 分钟
    whitelist: WHITELIST, // 引用上方统一配置
    blacklist: []  // 黑名单
}));

// 3. 启动配置
bot.start({
    polling: true,      // 开启轮询
    interval: 500,     // 轮询间隔 500 毫秒
    whitelist: WHITELIST, // 引用上方统一配置
    mentionString: "@", // [群聊优化] 必须 @机器人 名字才回复。例如 "@Bot"。留空则对所有白名单消息回复
    asyncMode: true    // true = 异步并行 (推荐, 响应快); false = 同步阻塞 (传统模式, 稳)
});
